01_original_cobol/ACCT-BAL-UPDATE.cbl

IDENTIFICATION DIVISION.
PROGRAM-ID. ACCT-BAL-UPDATE.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT ACCT-FILE ASSIGN TO "ACCTDATA.DAT".

DATA DIVISION.
FILE SECTION.
FD  ACCT-FILE.
01  ACCT-FILE-REC     PIC X(50).

WORKING-STORAGE SECTION.
01  WS-END-OF-FILE    PIC X VALUE 'N'.
01  ACCT-RECORD.
    05  ACCT-NO          PIC X(10).
    05  ACCT-BALANCE     PIC 9(10)V99.
    05  TRANS-AMT        PIC S9(7)V99.
    05  NEW-BALANCE      PIC 9(10)V99.
    05  STATUS-CODE      PIC X(10).

PROCEDURE DIVISION.
MAIN-LOGIC.
    OPEN I-O ACCT-FILE.
    PERFORM PROCESS-ACCT UNTIL WS-END-OF-FILE = 'Y'.
    CLOSE ACCT-FILE.
    STOP RUN.

PROCESS-ACCT.
    READ ACCT-FILE
        AT END MOVE 'Y' TO WS-END-OF-FILE
        NOT AT END
            COMPUTE NEW-BALANCE = ACCT-BALANCE + TRANS-AMT
            IF NEW-BALANCE < 0
                MOVE 'OVERDRAWN' TO STATUS-CODE
            ELSE
                MOVE 'ACTIVE' TO STATUS-CODE
            END-IF
            REWRITE ACCT-FILE-REC
    END-READ.
